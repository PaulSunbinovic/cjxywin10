<script>
	var doadd='__URL__/doadd';
	var dolinkage='__URL__/dolinkage';
	var obj=new Object();
	var addormdf="{$id}";
	obj["{$lowmdmk}"+"id"]="{$id}";
	obj["f_"+"{$lowmdmk}"+"_"+"{$splitmark}"+'id']="{$gid}";
	
</script>
<!--table部分-->
<div class='col-md-12' style='padding-top: 20px;'>

	<!--#######################-->
	<style>
	.mingxi table{margin-left:50px;border-spacing:0;padding:0;background-color:#f4f7f3;margin-top:20px;margin-bottom:20px;}
	.mingxi table td{border:1px #dff0d8 solid; padding:2px 5px;}
	.mingxi input{border:1px solid #ccc}
	.mingxi select{border:1px solid #ccc}
	</style>
			
	<div class='mingxi'>
	专业信息：<input type="hidden" id='f_std_sttid' value="1"><input type='hidden' id='f_stdxqpmj_xqid' value="{$mo['f_stdxqpmj_xqid']}">
	<table>
	<tr>
	<td>
	年级：
	</td>
	<td>
		<select id='f_std_grdid'>
			<volist name='f_std_grdid' id='vo'><option value="{$vo['grdid']}">{$vo['grdnm']}</option></volist>
		</select>
	</td>
	<td>
	办学形式：
	</td>
	<td>
	<select id='f_pmj_bxxsid' >
		<option value='0'>无</option>
		<volist name='f_pmj_bxxsid' id='vo'>
		<option value="{$vo['bxxsid']}">{$vo['bxxsnm']}</option>
		</volist>
	</select>
	</td>
	
	<td><input type='hidden' id='f_stdxqpcls_pclsid' value='0' /></td>
	
	<td><p style='color:#3c763d'>*专业：</p></td>
	<td colspan=9>
	<select id='f_stdxqpmj_pmjid'>
		<option value='0'>无</option>
		<volist name='f_stdxqpmj_pmjid' id='vo'>
		<option value="{$vo['mjid']}">{$vo['mjnm']}（{$vo['mjdsc']}）</option>
		</volist>
	</select>
	
	</td>
	</tr>
	</table>
	</div>
	
	<div class='mingxi'>
	基本信息：
	<table>
	<tr>
	<td><p style='color:#3c763d'>*姓名：</p></td><td><input type='text' id='stdnm'/></td>
	<td>
	<p style='color:#3c763d'>*性别：</p>
	</td>
	<td>
	<select id='f_std_sexid'>
		<option value='0'>无</option>
		<volist name='f_std_sexid' id='vo'>
		<option value="{$vo['sexid']}">{$vo['sexnm']}</option>
		</volist>
	</select>
	
	</td>
	<td>
	<p style='color:#3c763d'>*民族</p>
	</td>
	<td>
	<select id='f_std_rcid'>
		<option value='0'>无</option>
		<volist name='f_std_rcid' id='vo'>
		<option value="{$vo['rcid']}">{$vo['rcnm']}</option>
		</volist>
	</select>
	
	</td>
	<td>
	<p style='color:#3c763d'>*政治面貌</p>
	</td>
	<td>
	<select id='f_std_zzmmid'>
		<option value='0'>无</option>
		<volist name='f_std_zzmmid' id='vo'>
		<option value="{$vo['zzmmid']}">{$vo['zzmmnm']}</option>
		</volist>
	</select>
	</td>
	<td rowspan=4>
	<div>
	<!-- file start -->
	 <link rel="stylesheet" href="__PUBLIC__/etc/FileUpload/uploadify/uploadify.css">
	 <script type="text/javascript" src='__PUBLIC__/etc/FileUpload/uploadify/uploadify.js'></script>
	 <script type="text/javascript" src="__PUBLIC__/etc/FileUpload/uploadify/swfobject.js"></script>
	<script type="text/javascript">
	var file_path='__PUBLIC__/etc/FileUpload';
	var hdlupload="__APP__/FileUpload/upload/issml/y/wjj/std-jn-tmp";////注意
	var upload_path="__ROOT__/Uploads/std/tmp";
	</script>
	<script type="text/javascript" src='__PUBLIC__/etc/FileUpload/int.js'></script>
	<div>
	<img src="{$mo['stdpt']}" alt=""  class='img-thumbnail'  style="width:100px;"  id='imgg'/>
	</div>
	<div style="width:80px; height:26px; overflow:hidden;"><input type="file"  name="photo1" id="uploadify"/></div>
	<!-- 隐藏系统所需的用户upt -->
	<input type='hidden'  id='stdpt' value="{$mo['stdpt']}">
	<!-- file over -->
	</div>
	</td>
	</tr>
	<tr>
	<td><p style='color:#3c763d'>*籍贯：</p></td><td><input type='text' name='stdnp' value="{$mo['stdnp']}" id='stdnp'/></td>
	<td>文理科：</td>
	<td>
	<select id='stdsol'>
	<option value='无'>无</option>
	<option value='文科'>文科</option>
	<option value='理科'>理科</option>
	</select>
	</td>
	<td>
	学历
	</td>
	<td>
	<select id='f_std_xlid'>
		<option value='0'>无</option>
		<volist name='f_std_xlid' id='vo'>
		<option value="{$vo['xlid']}">{$vo['xlnm']}</option>
		</volist>
	</select>
	</td>
	<td>高考成绩：</td><td><input type='text' id='stdcee'/></td>
	</tr>
	<tr>
	<td>毕业学校：</td><td colspan=3><input  type='text' id='stdsog' style='width:330px'/></td>
	<td><p style='color:#3c763d'>*身份证号码：</p></td><td colspan=3><input  type='text' id='stdidcd' style='width:330px'/></td>
	</tr>
	<tr>
	<td><p style='color:#3c763d'>*手机号码：</p></td><td><input  type='text' id='stdcp' /></td>
	<td>固话：</td><td><input  type='text' id='stdtlp' /></td>
	<td><p style='color:#3c763d'>*出生日期：</p></td><td><script type="text/javascript" src="__PUBLIC__/etc/DTPK/jddate/adddate.js"></script><input type='text' id='stdbtd' onclick="SelectDate(this,'yyyy-MM-dd')" readonly /></td>
	<td>QQ：</td><td><input type='text' id='stdqq'/></td>
	</tr>
	<tr>
	<td><p style='color:#3c763d'>*家长一关系：</p></td><td><input type='text' id='stdrlta' placeholder='例如：父子，母子，爷爷等'/></td>
	<td><p style='color:#3c763d'>*家长一姓名：</p></td><td><input type='text' id='stdrltanm'/></td>
	<td><p style='color:#3c763d'>*家长一单位：</p></td><td><input type='text' id='stdrltaocpt'/></td>
	<td><p style='color:#3c763d'>*家长一手机号：</p></td><td colspan=2><input type='text' id='stdrltacp'/></td>
	</tr>
	<tr>
	<td>家长二关系：</td><td><input type='text' id='stdrltb' placeholder='例如：父子，母子，爷爷等'/></td>
	<td>家长二姓名：</td><td><input type='text' id='stdrltbnm'/></td>
	<td>家长二单位：</td><td><input type='text' id='stdrltbocpt'/></td>
	<td>家长二手机号：</td><td colspan=2><input type='text' id='stdrltbcp'/></td>
	</tr>
	<tr>
	<td>爱好：</td><td><input type='text' id='stdhb'/></td>
	<td><p style='color:#3c763d'>*家庭地址：</p></td><td colspan=3><input type='text' id='stdads' style='width:330px'/></td>
	<td>邮政编码：</td><td colspan=2><input type='text' id='stdpst'/></td>
	</tr>
	<tr>
	
	<td>推荐人姓名：</td><td colspan=2><input type='text' id='stdrcmdnm' placeholder='若无推荐人则不用填写'/></td>
	<td>推荐人手机号：</td><td colspan=3><input type='text' id='stdrcmdcp' placeholder='若无推荐人则不用填写'/></td>
	<td colspan="2"></td>
	</tr>
	<input type="hidden" id='f_std_statid' value='0' >
	<input type="hidden" id='stdpw' value='0' >
	<input type="hidden" id='stdpertm' value='' >
	<input type="hidden" id='stdertm' value='0' >
	<input type="hidden" id='stdicbc' value='0' >
	<input type="hidden" id='stdpnttm' value='0' >
	<input type="hidden" id='stdaddtm' value='0' >
	<input type="hidden" id='stdmdftm' value='0' >
	</table>
	<p style='color:#f00'>注：*号标记的必须填写</p>
	</div>
	
	<a class='btn btn-success btn-lg' id='panduan'>提交报名</a>

<div id='myModal' style="display: none;" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">

	    <div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	      
	      <h4 class="modal-title" id="mySmallModalLabel">提示</h4>
	    </div>
	    <div class="modal-body">
	      	<p id='rslt'>aaa</p>
	    </div>
	    <div class="modal-footer">
	    <button type="button" class="btn btn-success" id='gttj' style='display:none'>没有问题，提交信息</button>
	    <button type="button" class="btn btn-danger" id='sureII' style='display:none'>再检查下，暂不提交</button>
	        <button type="button" class="btn btn-default" data-dismiss="modal" id='sure'>关闭</button>
	    </div>
	  </div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div>
<script>
//自身参数，初始数据
var para=new Object();
var selfpara=new Array();
var origindata=new Object();

<?php 
foreach($para as $k=>$v){ 
	if(!in_array($k, $notself)){
?>
para["{$k}"]="{$v}";
selfpara.push("{$k}");
origindata["{$k}"]="{$moforjs[$k]}";
<?php 
	}
} 
?>

//不用管的，也不用显示的
var no_update=new Array();
<?php 
foreach($no_update as $nuv){ 
?>
no_update.push("{$nuv}");
<?php 
} 
?>
//zabojin的属性里面在显示中，允许空的
var allowempty=new Array();
<?php 
foreach($allowempty as $aev){ 
?>
allowempty.push("{$aev}");
<?php 
} 
?>
//transmean
var transmeank=new Array();
<?php 
foreach($transmean as $tmvk=>$tmvv){ 
?>
transmeank.push("{$tmvk}");
<?php 
} 
?>

//#########
$(function(){
	$('#panduan').click(function(){
		var rslt=$('#rslt');
		//首先把相关的参数数据聚集起来，把自身更新需要的参数以及变动的数据进行传输
		//由于第一个往往是id所以，就不去考虑了
		//先判断是否为空
		for(var i=1;i<selfpara.length;i++){
			var key=selfpara[i];var tmp=$('#'+key);
			//如果是允许空的，就不用考虑他有没有空的事情了；反之不在这里头，就要考虑了
			if(no_update.indexOf(key)==-1&&allowempty.indexOf(key)==-1){var tagname=tmp.get(0).tagName;
				if(tagname=='INPUT'&&$.trim(tmp.val())==''){
					rslt.html(para[key]+'不能为空');$('#myModal').modal({});return;
				}else if(transmeank.indexOf(key)==-1&&tagname=='SELECT'&&$.trim(tmp.val())=='0'){
					rslt.html(para[key]+'未选择');$('#myModal').modal({});return;
				}
			}
			
		}
		//特殊的判断
		var pttnmbl=/^1[34578][0-9]{9}$/;
		if(!pttnmbl.test($.trim($('#stdcp').val()))){
			rslt.html('手机号码格式不正确！');
			$('#myModal').modal({
    	    	  //keyboard: false
    	    })
			return false;
		}
		if($.trim($('#stdidcd').val()).length!=18){
			rslt.html('身份证号码必须18位！');
			$('#myModal').modal({
    	    	  //keyboard: false
    	    })
			return false;
		}
		//var pttnmbl=/^1[34578][0-9]{9}$/;
		if(!pttnmbl.test($.trim($('#stdrltacp').val()))){
			rslt.html('家长一手机号码格式不正确！');
			$('#myModal').modal({
    	    	  //keyboard: false
    	    })
			return false;
		}

		if($.trim($('#stdml').val())!=''){
			var pttneml=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
			if(!pttneml.test($.trim($('#stdml').val()))){
				rslt.html('邮箱格式不正确！');
				$('#myModal').modal({
	    	    	  //keyboard: false
	    	    })
				return false;
			}
		}

		
		if($('#f_stdxqpmj_pmjid').val()==0){
			rslt.html('请选择专业！');
			$('#myModal').modal({
    	    	  //keyboard: false
    	    })
			return false;
		}
		// if($.trim($('#stdpst').val())!=''&&(!(!isNaN($.trim($('#stdpst').val()))&&$.trim($('#stdpst').val()).length==6))){//非空情况下 是数字且6位之外的情况都是耍流氓
		// 	rslt.html('邮编格式不正确！');
		// 	$('#myModal').modal({
  //   	    	  //keyboard: false
  //   	    })
		// 	return false;
		// }

		$('#gttj').show();
		$('#sureII').show();
		$('#sure').hide();
		rslt.html('本系统不支持修改信息，请确定是否信息无误？（如果提交后发现有信息需要修改，请联系0571-86835789）');
		$('#myModal').modal({
	    	  //keyboard: false
	    })
		
	})

	$('#gttj').click(function(){
		//然后判断哪些是有变动的，变动的数值需要提交修改，没有变动的则直接不用接后台了
		//其中添加需要全盘给上，修改只用给变量就行
		if(addormdf!=0){
			var flag_change=0;
			for(var i=1;i<selfpara.length;i++){
				//排除掉不用管的
				var key=selfpara[i];var tmp=$('#'+key);var valuenow=$.trim(tmp.val());
				if(no_update.indexOf(key)==-1){
					if(valuenow!=origindata[key]){
						flag_change=1;
						obj[key]=valuenow;
					}
				}
			}
			if(flag_change==0){alert('没有任何信息改变');return;}
		}else{
			for(var i=1;i<selfpara.length;i++){
				var key=selfpara[i];var tmp=$('#'+key);var valuenow=$.trim(tmp.val());
				if(no_update.indexOf(key)==-1){
					obj[key]=valuenow;
				}
			}
			//添加学籍信息（因为学籍信息不被上传）
			obj['f_stdxqpmj_pmjid']=$('#f_stdxqpmj_pmjid').val();
			obj['f_stdxqpmj_xqid']=$('#f_stdxqpmj_xqid').val();
			
		}
		
		$('#sure').trigger('click');
		$.ajax({
            'type': 'GET',
            'url':doadd,
            'async':false,  
            'contentType': 'application/json',
            'data': obj,
            'dataType': 'json',
            'success': function(data) {
            	var pattern=data['pattern'];
            	var str='';
            	if(pattern=='0'){alert('报名成功！');window.location.href=__url__+'/view';}
            	if(pattern=='3'){alert('该身份证已经报过名了！');}
            	if(pattern=='4'){alert('身份证号码与出生日期不相符！');}
            	
                console.log("success");
            },
            'error':function() {
                console.log("error");
            }
        });
	})
})
</script>

<script>

$(function(){
  //记录
  var ipf=new Array();
  <?php foreach($impactfactor as $ifv){ ?>
    ipf.push("{$ifv}");
  <?php } ?>
  <?php foreach($impactfactor as $ifv){ ?>
    $('#'+"{$ifv}").change(function(){
      var obj=new Object();
      obj['trigger']="{$ifv}";
      for(var i=0;i<ipf.length;i++){
        obj[ipf[i]]=$('#'+ipf[i]).val();
      }
      $.ajax({
          'type': 'GET',
          'url':dolinkage,
          'async':false,  
          'contentType': 'application/json',
          'data': obj,
          'dataType': 'json',
          'success': function(data) {
            for(var i=0;i<data.length;i++){
              var aim=data[i]['aim'];
              var str="<option value='0'>无</option>";
              if(data[i]['ls']){
	              for(var j=0;j<data[i]['ls'].length;j++){
	                str=str+"<option value='"+data[i]['ls'][j][data[i]['prex']+'id']+"'>"+data[i]['ls'][j][data[i]['prex']+'nm']+"</option>"
	              }
	          }
              $('#'+aim).html(str);
            }
          },
          'error':function() {
            console.log("error");
          }
      });
    })
  <?php } ?>
})

</script>